<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to create and deploy rgee Shiny apps - I • rgee</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to create and deploy rgee Shiny apps - I">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rgee</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>

  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>

    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rgee01.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/rgee02.html">Consideration</a>
    </li>
    <li>
      <a href="../articles/rgee03.html">Best Practices</a>
    </li>
    <li>
      <a href="../articles/rgee04.html">Shiny apps deployment</a>
    </li>
    <li>
      <a href="../articles/rgee05.html">rgee and GCS sync</a>
    </li>
    <li>
      <a href="../articles/rgee06.html">Integrate Rmarkdown and rgee</a>
    </li>
    <li>
      <a href="https://r-earthengine.github.io/" class="external-link">rgee examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>

    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>

    functions
  </a>
</li>
<li>
  <a href="https://github.com/r-spatial/rgee/" class="external-link">
    <span class="fa fa-github fa-lg"></span>

    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to create and deploy rgee Shiny apps -
I</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/rgee/blob/master/vignettes/rgee04.Rmd" class="external-link"><code>vignettes/rgee04.Rmd</code></a></small>
      <div class="hidden name"><code>rgee04.Rmd</code></div>

    </div>

    
    
<p>Google Earth Engine (GEE) allows users to create apps by three
different approaches: <strong>user tokens</strong>, <a href="https://developers.google.com/earth-engine/guides/service_account" class="external-link">service
accounts</a> and <a href="https://github.com/google/earthengine-api/tree/master/demos/client-auth" class="external-link">client-side
authentication</a>. In this tutorial, we will get focus on the first
option.</p>
<div class="section level2">
<h2 id="what-is-an-ee-user-token-eetk">
<strong>What is an EE user token (EEtk)?</strong><a class="anchor" aria-label="anchor" href="#what-is-an-ee-user-token-eetk"></a>
</h2>
<p>An EEtk is a 100-character text string (OAuth2 credential) stored on
your local system that is used to identify and authenticate users (See
Figure below). In other words, it will permit to connect the EE Web REST
API with their local system.</p>
<p><br></p>
<center>
<img src="images%2Fr4_01.png" width="80%">
</center>
<p><br></p>
<p>In <strong>rgee</strong> the authentication procedure is triggered
internally by <a href="https://r-spatial.github.io/rgee/reference/ee_Initialize.html"><strong>ee_Initialize</strong></a>.
This <a href="https://github.com/google/earthengine-api/blob/b4c068924b1c7574ee717761cb9fe0499a3b932b/python/ee/data.py#L210%60" class="external-link">function</a>
will search for the ‘<strong><em>credentials</em></strong>’ file (it
stores the EEtk) on the path:
<strong>~/.config/earthengine/</strong>.</p>
<p><br></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/" class="external-link">rgee</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/credentials"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu">rgee</span><span class="fu">::</span><span class="fu"><a href="../reference/ee_get_earthengine_path.html">ee_get_earthengine_path</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>If the file exists, then an <a href="https://google-auth.readthedocs.io/en/stable/reference/google.oauth2.credentials.html" class="external-link">Oauth2
Credential</a> object is created using a <a href="https://developers.google.com/identity/protocols/oauth2" class="external-link">refresh
token</a> grant. This <em>refresh token</em> must come from a Google
account registered in GEE if not a <em>Bad Request error</em> will be
invoked. Once the Oauth2 Credential is successfully loaded, it is
dynamically passed to all EE methods (See <a href="https://github.com/google/earthengine-api/blob/b4c068924b1c7574ee717761cb9fe0499a3b932b/python/ee/__init__.py#L125" class="external-link">Initialize</a>)
in order to realize independent calls to the Web REST API. As you
realize, the <strong><em>credentials</em></strong> file is crucial to
interact with the EE API and if it does not exist on your system, it
will simply not be possible to use rgee.</p>
<center>
<br><strong>Please never show or share your token with anyone, it will
give full access to all your Earth Engine resources.</strong>
</center>
</div>
<div class="section level2">
<h2 id="deploying-a-simple-rgee-shiny-app-on-shinyapps-io">
<strong>Deploying a simple rgee shiny app on
shinyapps.io</strong><a class="anchor" aria-label="anchor" href="#deploying-a-simple-rgee-shiny-app-on-shinyapps-io"></a>
</h2>
<p>Deploying a rgee application can be a bit tricky, as you must perform
the following task:</p>
<ol style="list-style-type: decimal">
<li>Install R packages.</li>
<li>Install Python and third-party packages.</li>
<li>
<strong>Set the <em>credentials</em> file in the path
<em>~/.config/earthengine/</em></strong>.</li>
</ol>
<p>The first step is automatically accomplished for <a href="https://www.shinyapps.io/" class="external-link"><strong>shinyapps.io</strong></a>. On
the other hand, the second and third steps need to configure manually
the virtual machine. To make the process straightforward we create <a href="https://github.com/csaybar/shiny_rgee_template" class="external-link">shiny_rgee</a>
template.</p>
<br><center>
<img src="https://user-images.githubusercontent.com/16768318/146476146-6196f937-ad22-4687-bff0-1ca85f86806d.png" width="90%">
</center>
<p><br></p>
<p>To use shiny_rgee template, first download it by running on
terminal:</p>
<pre><code>git clone https://github.com/csaybar/shiny_rgee_template.git</code></pre>
<p>Load the rgeeApp.Rproj and modify the .Renviron file according to
their personal token user information. It is available in your shinyapps
profile <a href="https://www.shinyapps.io/admin/#/tokens" class="external-link uri">https://www.shinyapps.io/admin/#/tokens</a>.</p>
<br><center>
<img src="https://user-images.githubusercontent.com/16768318/146477123-6bec91ed-d5bb-42e6-aa6d-5f6b08d08d7f.png" width="90%">
</center>
<p><br></p>
<p><a href="https://github.com/csaybar/shiny_rgee_template/blob/main/.Renviron" class="external-link"><strong>.Renviron</strong></a></p>
<pre><code><span>    <span class="va">SHINY_ACC_NAME</span><span class="op">=</span><span class="st">"your_account_name"</span></span>
<span>    <span class="va">TOKEN</span><span class="op">=</span><span class="st">"a_token_you_got_from_shinyapps.io"</span></span>
<span>    <span class="va">SECRET</span><span class="op">=</span><span class="st">"a_secret_you_recieved_fromshinyapps.io"</span></span>
<span>    <span class="va">MASTERNAME</span><span class="op">=</span><span class="st">"name_of_the_shiny_app"</span></span></code></pre>
<p><br></p>
<p>Finally run the <a href="https://github.com/csaybar/shiny_rgee_template/blob/main/deploy.R" class="external-link"><strong>deploy.R</strong></a>
file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/rsconnect/" class="external-link">rsconnect</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/" class="external-link">rgee</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Create the credentials file</span></span>
<span><span class="fu"><a href="../reference/ee_Initialize.html">ee_Initialize</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Copy credentials file to the project folder</span></span>
<span><span class="va">file_credentials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/credentials"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu">rgee</span><span class="fu">::</span><span class="fu"><a href="../reference/ee_get_earthengine_path.html">ee_get_earthengine_path</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">file_credentials</span>, to <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Set ShinyApps account info</span></span>
<span><span class="co"># FIRST MODIFY LOCAL .Renviron!!</span></span>
<span><span class="va">error_on_missing_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="va">name</span>, unset<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cannot find "</span>,<span class="va">name</span><span class="op">)</span>,call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\""</span>, <span class="st">''</span>,<span class="va">var</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">setAccountInfo</span><span class="op">(</span>name   <span class="op">=</span> <span class="fu">error_on_missing_name</span><span class="op">(</span><span class="st">"SHINY_ACC_NAME"</span><span class="op">)</span>,</span>
<span>               token  <span class="op">=</span> <span class="fu">error_on_missing_name</span><span class="op">(</span><span class="st">"TOKEN"</span><span class="op">)</span>,</span>
<span>               secret <span class="op">=</span> <span class="fu">error_on_missing_name</span><span class="op">(</span><span class="st">"SECRET"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># 4. Run the application</span></span>
<span><span class="fu">deployApp</span><span class="op">(</span></span>
<span>  appFiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"app.R"</span>, <span class="st">"utils.R"</span>, <span class="st">"credentials"</span><span class="op">)</span>,</span>
<span>  appTitle <span class="op">=</span> <span class="st">"rgee_app_demo"</span>,</span>
<span>  lint <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Delete EE credentials file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"credentials"</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>After a couple of minutes, the app will be available on shinyapps.io.
See our live demo in <strong><a href="https://cesar-aybar.shinyapps.io/rgee_app_demo/" class="external-link uri">https://cesar-aybar.shinyapps.io/rgee_app_demo/</a></strong>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Cesar Aybar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
